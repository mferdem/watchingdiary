{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h3 class="mb-4">All Movies{% if selected_year %} - {{ selected_year }}{% endif %}</h3>

  <div class="mb-4 text-center">
    <div id="decadeButtons" class="mb-2 d-flex flex-wrap justify-content-center gap-2"
         data-selected-year="{{ selected_year or '' }}"></div>
    <div id="yearButtons" class="d-flex flex-wrap justify-content-center gap-2"></div>
  </div>

  {% if movies %}
  <div class="table-responsive">
    <table class="table table-striped table-bordered align-middle text-center">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Year</th>
          <th>Title</th>
          <th>Duration</th>
          <th>Rating</th>
          <th>Watch Count</th>
          <th>Cinema Count</th>
          <th>Last Watch</th>
        </tr>
      </thead>
      <tbody>
        {% for item in movies %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ item.movie.year or '-' }}</td>
            <td>
              {% if item.movie.imdb_id %}
                <a href="https://www.imdb.com/title/{{ item.movie.imdb_id }}" target="_blank" rel="noopener">
                  {{ item.movie.name }}
                </a>
              {% else %}
                {{ item.movie.name }}
              {% endif %}
            </td>
            <td>
              {% if item.movie.duration %}
                {{ item.movie.duration }} min / 
                {% set h = item.movie.duration // 60 %}
                {% set m = item.movie.duration % 60 %}
                {{ h }}h{% if m > 0 %} {{ m }}m{% endif %}
              {% else %}
                -
              {% endif %}
            </td>
            <td>{{ item.movie.rating or '-' }}</td>
            <td>{{ item.watch_count }}</td>
            <td>{{ item.cinema_count }}</td>
            <td>
              {% if item.last_watch %}
                {{ item.last_watch.strftime('%d %b %Y') }}
              {% else %}
                -
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <div class="alert alert-info">No movies found.</div>
  {% endif %}
</div>

<script src="{{ url_for('static', filename='js/movie_filter.js') }}"></script>

{% endblock %}
